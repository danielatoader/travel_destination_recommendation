<html>
  <head>
    <title>Travel Recommendation</title>
    <script type="text/javascript" src="brython.js"></script>
    <script type="text/javascript" src="brython_stdlib.js"></script>
  <link rel="icon" href="data:;base64,=">
  </head>
  <body onload="brython(1)">
    <script type="text/python3">
      from browser import document, ajax
      import json
      import warnings
 
      def get_random_cities(response):
          if response.status==200 or response.status==0:
              cities = json.loads(response.text)
              change_place_names(cities)
          else:
              warnings.warn(response.text)
      def get_user_scores(ev):
          """Get the predicted probability."""
          req = ajax.ajax()
          req.bind('complete', get_random_cities)
          req.open('POST', '/scores', False)
          req.set_header('content-type','application/json')
          user_inputs = {
              'user_input_forest': document['forest_slider'].value,
              'user_input_castle': document['castle_slider'].value,
              'user_input_water': document['water_slider'].value,
              'user_input_historical': document['historical_slider'].value,
              'user_input_urban': document['urban_slider'].value
            }
          data = json.dumps(user_inputs)
          req.send(data)
      
      def change_place_names(cities):
          for k, v in cities.items():
              place = repr(v)
              place = place.replace("'", "").replace("[", "").replace("]", "")
              document[f"place_{int(k)+1}"].textContent = place
              
      def show_random_places(ev):
         document["random_recs"].style.display = "inline"
      
      def show_recommendations(ev):
         document["final_recs"].style.display = "inline"
      
      def get_recs(response):
          if response.status==200 or response.status==0:
              recommendations = json.loads(response.text)
              clean_recommendations(recommendations)
              
          else:
              warnings.warn(response.text)
      def get_recommendations(ev):
          """Get the predicted probability."""
          req = ajax.ajax()
          req.bind('complete', get_recs)
          req.open('POST', '/recommend', True)
          req.set_header('content-type','application/json')
          user_inputs = {
              'user_input_place_1': document['place_1_rating'].value,
              'user_input_place_2': document['place_2_rating'].value,
              'user_input_place_3': document['place_3_rating'].value,
              'user_input_place_4': document['place_4_rating'].value,
              'user_input_place_5': document['place_5_rating'].value,
              'user_input_place_6': document['place_6_rating'].value,
              'user_input_place_7': document['place_7_rating'].value,
              'user_input_place_8': document['place_8_rating'].value,
              'user_input_place_9': document['place_9_rating'].value,
              'user_input_place_10': document['place_10_rating'].value
            }
          data = json.dumps(user_inputs)
          req.send(data)
      
      def clean_recommendations(recommendations):
          for k, v in recommendations.items():
              place = repr(v)
              place = place.replace("'", "").replace("[", "").replace("]", "")
              document[f"rec_{int(k)+1}"].textContent = place

      def get_sats(response):
          if response.status==200 or response.status==0:
              pass   
          else:
              warnings.warn(response.text)
      def get_satisfaction(ev):
          """Get the predicted probability."""
          req = ajax.ajax()
          req.bind('complete', get_sats)
          req.open('POST', '/rate_recs', True)
          req.set_header('content-type','application/json')
          user_inputs = {
              'rec_1_interest': document['rec_1_interest'].value,
              'rec_2_interest': document['rec_2_interest'].value,
              'rec_3_interest': document['rec_3_interest'].value,
              'rec_4_interest': document['rec_4_interest'].value,
              'rec_5_interest': document['rec_5_interest'].value
            }
          data = json.dumps(user_inputs)
          print(data)
          req.send(data)
          
      document["score_button"].bind("click", get_user_scores, show_random_places)
      document["city_rating_button"].bind("click", get_recommendations, show_recommendations)
      document["satisfaction_button"].bind("click", get_satisfaction)
            
      def update_forest_slider_label(ev):
             forest_slide_val = document["forest_slider"].value
             document["forest_label"].textContent = forest_slide_val
      
      def update_castle_slider_label(ev):
             castle_slide_val = document["castle_slider"].value
             document["castle_label"].textContent = castle_slide_val
      
      def update_water_slider_label(ev):
             water_slide_val = document["water_slider"].value
             document["water_label"].textContent = water_slide_val
      
      def update_historical_slider_label(ev):
             historical_slide_val = document["historical_slider"].value
             document["historical_label"].textContent = historical_slide_val
      
      def update_urban_slider_label(ev):
             urban_slide_val = document["urban_slider"].value
             document["urban_label"].textContent = urban_slide_val
     
             
      document["forest_slider"].bind("change", update_forest_slider_label)
      document["castle_slider"].bind("change", update_castle_slider_label)
      document["water_slider"].bind("change", update_water_slider_label)
      document["historical_slider"].bind("change", update_historical_slider_label)
      document["urban_slider"].bind("change", update_urban_slider_label)

     
    </script>
    <h1>Rate importance on a scale of 0 to 10</h1>  
    <div>Forest/Mountain</div>
    <div>
        <img src="images/forest_mountain.jpg" width="100" height="80">
    </div>
    <div class="slidecontainer">
        <input type="range" min="0" max="10" step="1" value="5" id="forest_slider" class="slider"/>
        <span id="forest_label">5</span>
    </div>
    <div>Palaces/Castles</div>
    <div>
        <img src="images/palace_castle.jpg" width="100" height="80">
    </div>
    <div class="slidecontainer">
      <input type="range" min="0" max="10" value="5" class="slider" id="castle_slider">
      <span id="castle_label">5</span>
    </div>
    <div>Coastal/Water</div>
    <div>
        <img src="images/coastal.jpg" width="100" height="80">
    </div>
    <div class="slidecontainer">
      <input type="range" min="0" max="10" value="5" class="slider" id="water_slider">
      <span id="water_label">5</span>
    </div>
    <div>Historical</div>
    <div>
        <img src="images/historical.jpg" width="100" height="80">
    </div>
    <div class="slidecontainer">
      <input type="range" min="0" max="10" value="5" class="slider" id="historical_slider">
      <span id="historical_label">5</span>
    </div>
    <div>Urban</div>
    <div>
        <img src="images/urban.jpg" width="100" height="80">
    </div>
    <div class="slidecontainer">
      <input type="range" min="0" max="10" value="5" class="slider" id="urban_slider">
      <span id="urban_label">5</span>
    </div>
    <button id="score_button">Submit</button>
      
     
    <div id="random_recs" style="display:none">   
        <h2>If you have been and liked type 1, if you have been and disliked type -1, if you have not been type 0</h2>
        <div id=place_1>place 1</div>
        <textarea id="place_1_rating"></textarea>
        <div id=place_2>place 2</div>
        <textarea id="place_2_rating"></textarea>
        <div id=place_3>place 3</div>
        <textarea id="place_3_rating"></textarea>
        <div id=place_4>place 4</div>
        <textarea id="place_4_rating"></textarea>
        <div id=place_5>place 5</div>
        <textarea id="place_5_rating"></textarea>
        <div id=place_6>place 6</div>
        <textarea id="place_6_rating"></textarea>
        <div id=place_7>place 7</div>
        <textarea id="place_7_rating"></textarea>
        <div id=place_8>place 8</div>
        <textarea id="place_8_rating"></textarea>
        <div id=place_9>place 9</div>
        <textarea id="place_9_rating"></textarea>
        <div id=place_10>place 10</div>
        <textarea id="place_10_rating"></textarea>
        <button id="city_rating_button">Find Top 5 Destinations</button>
     </div>
     
      
     <div id="final_recs" style="display:none">   
        <h2>Your recommendations: Indicate interest in visiting as 1 and 0 if you are not interested</h2>
        <div id=rec_1>rec 1</div>
        <textarea id="rec_1_interest"></textarea>
        <div id=rec_2>rec 2</div>
        <textarea id="rec_2_interest"></textarea>
        <div id=rec_3>rec 3</div>
        <textarea id="rec_3_interest"></textarea>
        <div id=rec_4>rec 4</div>
        <textarea id="rec_4_interest"></textarea>
        <div id=rec_5>rec 5</div>
        <textarea id="rec_5_interest"></textarea>
        <button id="satisfaction_button">My Satisfaction</button>
     </div>
  </body>
</html>